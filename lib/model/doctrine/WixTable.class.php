<?php

/**
 * WixTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class WixTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object WixTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Wix');
    }
    
    public static function getBy($instanceCode, $compCode){
    	$wix = Doctrine::getTable('Wix')
    		->createQuery('w')
    		->where('instance_code =?', $instanceCode)
    		->andWhere('comp_code =?', $compCode)
    		->fetchOne();

    	return $wix;
    }

    public static function removeAll($wixInstance, $userId){
        $data = Wix::getInstanceData($wixInstance);
        if ($data->instanceId && $userId){
            $wixs = Doctrine_Query::create()
                ->from('Wix w')
                ->where('w.instance_code = ?', $data->instanceId)
                ->andWhere('(w.user_id = ? OR w.user_id IS NULL)', $userId)
                ->execute();

            $wixs->delete();
        }
    }

    public static function bindAll($wixInstance, $userId){
        $data = Wix::getInstanceData($wixInstance);
        if ($data->instanceId && $userId){
            Doctrine_Query::create()
                ->update('Wix w')
                ->set('w.user_id', '?', $userId)
                ->where('w.instance_code = ?', $data->instanceId)
                ->execute();
        }
    }
}